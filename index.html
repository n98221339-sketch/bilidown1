<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>BiliDown â€” Táº£i Video Bilibili & Douyin</title>
<link href="https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&family=Noto+Sans+SC:wght@400;700&display=swap" rel="stylesheet">
<style>
:root{
  --bg:#0a0a0f; --panel:#111118; --border:#1e1e2e;
  --accent:#00e5ff; --a2:#ff3d6b; --a3:#7b61ff;
  --green:#00e676; --warn:#ffb300; --text:#e0e0f0; --muted:#555570;
  --card:#14141f; --ch:#1a1a2a;
  /* Button colors */
  --vid-bg:#071820;  --vid-fg:#00e5ff;
  --aud-bg:#071a0f;  --aud-fg:#00e676;
  --img-bg:#110d1e;  --img-fg:#7b61ff;
  --cmd-bg:#1a1200;  --cmd-fg:#ffb300;
}
*{box-sizing:border-box;margin:0;padding:0}
body{background:var(--bg);color:var(--text);font-family:'Space Mono',monospace;min-height:100vh;overflow-x:hidden}
body::before{content:'';position:fixed;inset:0;background-image:linear-gradient(rgba(0,229,255,0.03) 1px,transparent 1px),linear-gradient(90deg,rgba(0,229,255,0.03) 1px,transparent 1px);background-size:40px 40px;pointer-events:none;z-index:0}
.w{max-width:1060px;margin:0 auto;padding:0 16px;position:relative;z-index:1}

/* HEADER */
header{padding:16px 0 12px;border-bottom:1px solid var(--border);display:flex;align-items:center;gap:12px;flex-wrap:wrap}
.logo{width:38px;height:38px;background:linear-gradient(135deg,var(--accent),var(--a3));border-radius:9px;display:flex;align-items:center;justify-content:center;font-size:18px;flex-shrink:0}
header h1{font-size:18px;letter-spacing:2px;color:var(--accent)}
header p{font-size:9px;color:var(--muted);margin-top:2px;font-family:'Noto Sans SC',sans-serif}
.htags{margin-left:auto;display:flex;gap:6px;align-items:center}
.ptag{padding:2px 8px;border-radius:4px;font-size:8px;letter-spacing:1px;border:1px solid}
.ptag.bili{color:#00b5e2;border-color:#00b5e2;background:rgba(0,181,226,0.08)}
.ptag.dy{color:var(--a2);border-color:var(--a2);background:rgba(255,61,107,0.08)}
.ytdlp-badge{font-size:8px;padding:2px 10px;border-radius:10px;border:1px solid var(--green);color:var(--green);background:rgba(0,230,118,0.06)}

/* TABS */
.tabs{display:flex;margin:16px 0 0;border-bottom:1px solid var(--border)}
.tab{padding:8px 16px;font-size:10px;letter-spacing:1px;cursor:pointer;color:var(--muted);border-bottom:2px solid transparent;transition:all .2s;background:none;border-top:none;border-left:none;border-right:none;font-family:'Space Mono',monospace}
.tab.active{color:var(--accent);border-bottom-color:var(--accent)}
.tab:hover:not(.active){color:var(--text)}
.tbadge{background:var(--a3);color:#fff;border-radius:8px;font-size:8px;padding:1px 5px;margin-left:4px}
.tab-pane{display:none;padding:16px 0}
.tab-pane.active{display:block}

/* CARDS */
.card{background:var(--panel);border:1px solid var(--border);border-radius:9px;padding:14px;margin-bottom:12px}
.clabel{font-size:9px;color:var(--muted);letter-spacing:1px;margin-bottom:7px;display:block}

/* INPUTS */
textarea,input[type=text]{width:100%;background:var(--bg);border:1px solid var(--border);color:var(--text);font-family:'Space Mono',monospace;font-size:11px;border-radius:5px;padding:9px 11px;resize:vertical;outline:none;transition:border-color .2s}
textarea{height:96px}
textarea:focus,input:focus{border-color:var(--accent)}
select{background:var(--bg);border:1px solid var(--border);color:var(--text);font-family:'Space Mono',monospace;font-size:10px;padding:5px 8px;border-radius:4px;outline:none;cursor:pointer}
select:focus{border-color:var(--accent)}

/* INFO BOXES */
.info-box{border-radius:7px;padding:10px 14px;font-size:10px;margin-bottom:12px;line-height:1.8;font-family:'Noto Sans SC',sans-serif}
.info-ytdlp{background:rgba(0,230,118,0.05);border:1px solid rgba(0,230,118,0.2);color:var(--green)}
.info-warn{background:rgba(255,179,0,0.05);border:1px solid rgba(255,179,0,0.2);color:var(--warn)}
.info-box b{font-family:'Space Mono',monospace}

/* OPTIONS */
.opts{display:flex;gap:10px;flex-wrap:wrap;align-items:flex-end}
.og{display:flex;flex-direction:column;gap:4px}
.og label{font-size:9px;color:var(--muted);letter-spacing:1px}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   BUTTONS â€” 4 TYPES CLEAR
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.btn{padding:8px 16px;border-radius:6px;font-family:'Space Mono',monospace;font-size:10px;letter-spacing:.5px;cursor:pointer;border:none;transition:all .16s;display:inline-flex;align-items:center;gap:6px;white-space:nowrap;font-weight:700}
.btn:active{transform:scale(.97)}
.btn:disabled{opacity:.3;cursor:not-allowed;transform:none!important}

/* ğŸ“¹ VIDEO+Ã‚M â€” cyan glow */
.btn-vid{background:var(--vid-bg);color:var(--vid-fg);border:1px solid var(--vid-fg);box-shadow:0 0 8px rgba(0,229,255,0.15)}
.btn-vid:hover{background:#0d2a36;box-shadow:0 0 14px rgba(0,229,255,0.3);transform:translateY(-1px)}

/* ğŸµ CHá»ˆ AUDIO â€” green glow */
.btn-aud{background:var(--aud-bg);color:var(--aud-fg);border:1px solid var(--aud-fg);box-shadow:0 0 8px rgba(0,230,118,0.15)}
.btn-aud:hover{background:#0d2d16;box-shadow:0 0 14px rgba(0,230,118,0.3);transform:translateY(-1px)}

/* ğŸ–¼ Táº¢I áº¢NH â€” purple */
.btn-img{background:var(--img-bg);color:var(--img-fg);border:1px solid var(--img-fg)}
.btn-img:hover{background:#1c1435;transform:translateY(-1px)}

/* ğŸ“‹ Lá»†NH / CMD â€” amber */
.btn-cmd{background:var(--cmd-bg);color:var(--cmd-fg);border:1px solid var(--cmd-fg)}
.btn-cmd:hover{background:#2a1e00;transform:translateY(-1px)}

/* Secondary / Danger */
.btn-sec{background:transparent;color:var(--text);border:1px solid var(--border)}
.btn-sec:hover{border-color:var(--text)}
.btn-del{background:transparent;color:var(--a2);border:1px solid var(--a2)}
.btn-del:hover{background:rgba(255,61,107,0.08)}
.btn-prim{background:var(--accent);color:var(--bg);border:none;font-weight:700}
.btn-prim:hover{background:#33eeff;transform:translateY(-1px)}

.sm{padding:4px 10px;font-size:9px;border-radius:4px}

/* STATS */
.stats{display:flex;gap:14px;padding:6px 0;margin-bottom:8px;font-size:9px;flex-wrap:wrap}
.stat{display:flex;align-items:center;gap:4px}
.dot{width:5px;height:5px;border-radius:50%}

/* TOOLBAR */
.tb{display:flex;gap:6px;margin-bottom:10px;flex-wrap:wrap;align-items:center}
.tb-sep{width:1px;height:22px;background:var(--border);margin:0 4px;flex-shrink:0}
.tb-lbl{font-size:8px;color:var(--muted);letter-spacing:1px}

/* VIDEO LIST */
.vlh{display:flex;align-items:center;gap:8px;padding:7px 11px;background:rgba(0,0,0,.4);border:1px solid var(--border);border-radius:7px 7px 0 0;font-size:8px;color:var(--muted);letter-spacing:1px}
.vlist{border:1px solid var(--border);border-top:none;border-radius:0 0 7px 7px;overflow:hidden}

/* VIDEO ITEM */
.vi{display:flex;align-items:center;gap:9px;padding:8px 11px;background:var(--card);border-bottom:1px solid var(--border);transition:background .12s;border-left:3px solid transparent}
.vi:last-child{border-bottom:none}
.vi:hover{background:var(--ch)}
.vi.sel{background:rgba(0,229,255,0.04);border-left-color:var(--accent)}
.vi.loading{border-left-color:var(--warn)}
.vi.done{border-left-color:var(--green)}
.vi.error{border-left-color:var(--a2)}

/* CHECKBOX */
.ck{flex-shrink:0;cursor:pointer;user-select:none}
.ck input{display:none}
.ck-box{width:14px;height:14px;border:1px solid var(--muted);border-radius:3px;display:flex;align-items:center;justify-content:center;font-size:9px;transition:all .15s}
.ck input:checked+.ck-box{background:var(--accent);border-color:var(--accent);color:var(--bg)}

/* THUMB */
.vthumb{width:68px;height:43px;border-radius:4px;background:var(--border);flex-shrink:0;overflow:hidden;display:flex;align-items:center;justify-content:center;font-size:16px;cursor:pointer;position:relative}
.vthumb img{width:100%;height:100%;object-fit:cover}
.vthumb .pov{position:absolute;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,.5);font-size:18px}
.vthumb:hover .pov{display:flex}

/* INFO */
.vinfo{flex:1;min-width:0;cursor:pointer}
.vtitle{font-size:11px;color:var(--text);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;font-family:'Noto Sans SC',sans-serif;margin-bottom:2px}
.vurl{font-size:8px;color:var(--muted);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;margin-bottom:3px}
.vmeta{display:flex;gap:5px;flex-wrap:wrap}
.badge{font-size:7px;padding:1px 5px;border-radius:3px}
.bbili{background:rgba(0,181,226,.15);color:#00b5e2}
.bdy{background:rgba(255,61,107,.15);color:var(--a2)}
.bq{background:rgba(123,97,255,.15);color:var(--a3)}
.bok{background:rgba(0,230,118,.15);color:var(--green)}

/* ACTION BUTTONS in item */
.vacts{display:flex;gap:4px;flex-shrink:0}

/* STATUS */
.vstat{font-size:8px;flex-shrink:0;width:60px;text-align:right;font-family:'Space Mono',monospace}
.sw{color:var(--muted)}.sl{color:var(--warn)}.sd{color:var(--green)}.se{color:var(--a2)}

/* PROG */
.pw{height:2px;background:var(--border);border-radius:1px;margin-top:4px;display:none}
.pb{height:100%;background:var(--accent);border-radius:1px;transition:width .4s}
.vi.loading .pw{display:block}

/* EMPTY */
.empty{padding:48px 20px;text-align:center;color:var(--muted);font-family:'Noto Sans SC',sans-serif}
.empty .ico{font-size:38px;margin-bottom:10px}

/* LOG */
.logbox{background:var(--bg);border:1px solid var(--border);border-radius:7px;padding:9px 11px;font-size:9px;height:100px;overflow-y:auto;margin-top:12px}
.ll{padding:1px 0;font-family:'Space Mono',monospace}
.li{color:var(--accent)}.lo{color:var(--green)}.le{color:var(--a2)}.lw{color:var(--warn)}

/* MODAL */
.mov{display:none;position:fixed;inset:0;background:rgba(0,0,0,.88);z-index:300;align-items:center;justify-content:center}
.mov.open{display:flex}
.modal{background:var(--panel);border:1px solid var(--border);border-radius:11px;padding:22px;width:600px;max-width:96vw;max-height:92vh;overflow-y:auto}
.modal h3{font-size:12px;color:var(--accent);margin-bottom:14px;letter-spacing:1px}
.mc{float:right;font-size:15px;cursor:pointer;color:var(--muted);background:none;border:none;font-family:'Space Mono',monospace}
.mc:hover{color:var(--text)}
.modal img{width:100%;border-radius:5px;margin-bottom:12px;border:1px solid var(--border)}
.minfo{font-size:10px;color:var(--muted);line-height:1.8;font-family:'Noto Sans SC',sans-serif;margin-bottom:12px}
.minfo strong{color:var(--text)}
.macts{display:flex;gap:8px;flex-wrap:wrap;margin-top:14px}

/* CMD BOX */
.cmdbox{display:flex;gap:8px;align-items:flex-start;margin-top:8px}
.cmdbox textarea{height:60px;font-size:9px;color:var(--green);background:#07100a;border-color:rgba(0,230,118,.3);flex:1;resize:none;font-family:'Space Mono',monospace}
.cmdbox textarea:focus{border-color:var(--green)}

/* GUIDE */
.gs{margin-bottom:18px}
.gs h4{font-size:10px;letter-spacing:1px;margin-bottom:7px;font-family:'Space Mono',monospace}
.gs p{font-size:12px;color:var(--text);line-height:1.8;font-family:'Noto Sans SC',sans-serif}
code.blk{display:block;background:var(--bg);border:1px solid var(--border);border-radius:4px;padding:9px 11px;font-size:9px;color:var(--green);margin:7px 0;line-height:1.8;word-break:break-all;font-family:'Space Mono',monospace;white-space:pre-wrap}

::-webkit-scrollbar{width:3px;height:3px}
::-webkit-scrollbar-track{background:var(--bg)}
::-webkit-scrollbar-thumb{background:var(--border);border-radius:2px}
::-webkit-scrollbar-thumb:hover{background:var(--muted)}
@keyframes fadeIn{from{opacity:0;transform:translateY(4px)}to{opacity:1;transform:none}}
.vi{animation:fadeIn .16s ease}
</style>
</head>
<body>
<div class="w">

<!-- HEADER -->
<header>
  <div class="logo">â¬‡</div>
  <div>
    <h1>BILIDOWN</h1>
    <p>Bilibili &amp; Douyin â€” yt-dlp Engine</p>
  </div>
  <div class="htags">
    <span class="ptag bili">BILIBILI</span>
    <span class="ptag dy">DOUYIN</span>
    <span class="ytdlp-badge">âš™ yt-dlp</span>
  </div>
</header>

<!-- TABS -->
<div class="tabs">
  <button class="tab active" onclick="sw('input')">ğŸ“¥ NHáº¬P LINK</button>
  <button class="tab" onclick="sw('queue')">ğŸ“‹ DANH SÃCH <span class="tbadge" id="qc">0</span></button>
  <button class="tab" onclick="sw('guide')">ğŸ“– HÆ¯á»šNG DáºªN</button>
</div>

<!-- â•â•â• TAB NHáº¬P LINK â•â•â• -->
<div class="tab-pane active" id="tab-input">

  <div class="info-ytdlp info-box">
    <b>âš™ yt-dlp Engine â€” 3 nÃºt táº£i rÃµ rÃ ng cho má»—i video:</b><br>
    <b style="color:var(--vid-fg)">ğŸ“¹ VIDEO+Ã‚M</b> &nbsp;â€”&nbsp; Video Ä‘áº§y Ä‘á»§ cÃ³ Ã¢m thanh (mp4)<br>
    <b style="color:var(--aud-fg)">ğŸµ CHá»ˆ AUDIO</b> &nbsp;â€”&nbsp; Chá»‰ Ã¢m thanh (mp3/aac/wav...)<br>
    <b style="color:var(--img-fg)">ğŸ–¼ Táº¢I áº¢NH</b> &nbsp;â€”&nbsp; Thumbnail/áº£nh bÃ¬a<br>
    <b style="color:var(--cmd-fg)">ğŸ“‹ Lá»†NH yt-dlp</b> &nbsp;â€”&nbsp; Copy lá»‡nh dÃ¡n vÃ o Terminal Ä‘á»ƒ táº£i
  </div>

  <div class="info-warn info-box">
    <b>âš¡ Lá»c link tá»± Ä‘á»™ng</b> â€” DÃ¡n text láº«n chá»¯ Trung Ä‘á»u OK:<br>
    <code style="color:var(--accent)">ã€å†¥æ²³ç¬¬ä¹é›† æ­»äº¡ åŠ¨ç”»ã€‘ https://bilibili.com/video/BV1Ez...</code><br>
    â†’ Tá»± lá»c: <code style="color:var(--green)">https://bilibili.com/video/BV1Ez...</code>
  </div>

  <div class="card">
    <span class="clabel">DÃN LINK / TEXT CÃ“ LINK (má»—i dÃ²ng 1 má»¥c)</span>
    <textarea id="linkin" placeholder="DÃ¡n link vÃ o Ä‘Ã¢y, má»—i dÃ²ng 1 link:
ã€å†¥æ²³ï¼ˆäººè¯¡ç–‘äº‘ï¼‰ç¬¬ä¹é›† æ­»äº¡ åŠ¨ç”»ã€‘ https://www.bilibili.com/video/BV1EzGiz1ETU/
https://www.douyin.com/video/7321234567890
https://b23.tv/aBcDe"></textarea>
  </div>

  <div class="card">
    <div class="opts">
      <div class="og"><label>CHáº¤T LÆ¯á»¢NG VIDEO</label>
        <select id="qsel">
          <option value="best">ğŸ† Cao nháº¥t (Best)</option>
          <option value="1080">ğŸ¬ 1080p Full HD</option>
          <option value="720">ğŸ“º 720p HD</option>
          <option value="480">ğŸ“± 480p</option>
          <option value="360">ğŸ’¾ 360p</option>
        </select>
      </div>
      <div class="og"><label>VIDEO FORMAT</label>
        <select id="vfmt"><option>mp4</option><option>mkv</option><option>webm</option></select>
      </div>
      <div class="og"><label>AUDIO FORMAT</label>
        <select id="afmt"><option>mp3</option><option>aac</option><option>m4a</option><option>opus</option><option>ogg</option><option>wav</option><option>flac</option></select>
      </div>
      <div class="og"><label>TÃ™Y CHá»ŒN THÃŠM</label>
        <div style="display:flex;gap:14px;align-items:center;padding:4px 0">
          <label style="display:flex;align-items:center;gap:6px;cursor:pointer;font-size:10px">
            <input type="checkbox" id="opt-thumb" checked style="accent-color:var(--accent)"> Táº£i Thumbnail
          </label>
          <label style="display:flex;align-items:center;gap:6px;cursor:pointer;font-size:10px">
            <input type="checkbox" id="opt-embed" style="accent-color:var(--accent)"> NhÃºng Thumbnail
          </label>
        </div>
      </div>
    </div>
  </div>

  <div style="display:flex;gap:8px;flex-wrap:wrap">
    <button class="btn btn-prim" onclick="parseLinks()">ğŸ” PHÃ‚N TÃCH LINK</button>
    <button class="btn btn-sec" onclick="document.getElementById('linkin').value=''">ğŸ—‘ XÃ³a</button>
  </div>
</div>

<!-- â•â•â• TAB DANH SÃCH â•â•â• -->
<div class="tab-pane" id="tab-queue">
  <div class="stats">
    <span class="stat"><span class="dot" style="background:var(--muted)"></span><span id="st-t">0</span> tá»•ng</span>
    <span class="stat"><span class="dot" style="background:var(--accent)"></span><span id="st-s">0</span> Ä‘Ã£ chá»n</span>
    <span class="stat"><span class="dot" style="background:var(--green)"></span><span id="st-d">0</span> xong</span>
    <span class="stat"><span class="dot" style="background:var(--a2)"></span><span id="st-e">0</span> lá»—i</span>
  </div>

  <div class="tb">
    <label class="ck" style="font-size:10px;display:flex;align-items:center;gap:6px;cursor:pointer">
      <input type="checkbox" id="chkall" onchange="toggleAll(this)">
      <span class="ck-box" id="allbox">â˜</span>
      <span>Chá»n táº¥t cáº£</span>
    </label>

    <div class="tb-sep"></div>
    <span class="tb-lbl">Táº¢I CHá»ŒN:</span>

    <!-- 2 nÃºt chÃ­nh rÃµ rÃ ng -->
    <button class="btn btn-vid sm" id="btn-sv" onclick="batchDl('video')" disabled>ğŸ“¹ VIDEO+Ã‚M</button>
    <button class="btn btn-aud sm" id="btn-sa" onclick="batchDl('audio')" disabled>ğŸµ CHá»ˆ AUDIO</button>

    <div class="tb-sep"></div>
    <span class="tb-lbl">Táº¤T Cáº¢:</span>
    <button class="btn btn-vid sm" onclick="batchAll('video')">ğŸ“¹ VIDEO+Ã‚M</button>
    <button class="btn btn-aud sm" onclick="batchAll('audio')">ğŸµ CHá»ˆ AUDIO</button>

    <div style="flex:1"></div>
    <button class="btn btn-del sm" onclick="clearQ()">ğŸ—‘ XÃ³a hÃ ng Ä‘á»£i</button>
  </div>

  <div id="vwrap">
    <div class="empty"><div class="ico">ğŸ“­</div><p>ChÆ°a cÃ³ link nÃ o â€” nháº­p link á»Ÿ tab NHáº¬P LINK</p></div>
  </div>

  <div class="logbox" id="logbox"></div>
</div>

<!-- â•â•â• TAB HÆ¯á»šNG DáºªN â•â•â• -->
<div class="tab-pane" id="tab-guide">
  <div class="card" style="line-height:1.9">

    <div class="gs">
      <h4 style="color:var(--accent)">â‘  CÃ€I Äáº¶T yt-dlp</h4>
      <code class="blk">pip install yt-dlp</code>
      <p>Hoáº·c táº£i binary: <a href="https://github.com/yt-dlp/yt-dlp/releases" target="_blank" style="color:var(--accent)">github.com/yt-dlp/yt-dlp/releases</a></p>
    </div>

    <div class="gs">
      <h4 style="color:var(--vid-fg)">â‘¡ ğŸ“¹ VIDEO+Ã‚M â€” Lá»‡nh yt-dlp</h4>
      <code class="blk"># Video 1080p cÃ³ Ã¢m thanh + thumbnail:
yt-dlp -f "bestvideo[height&lt;=1080]+bestaudio" --merge-output-format mp4 --write-thumbnail -o "%(title)s.%(ext)s" [URL]

# Video cháº¥t lÆ°á»£ng cao nháº¥t:
yt-dlp -f "bestvideo+bestaudio" --merge-output-format mp4 -o "%(title)s.%(ext)s" [URL]</code>
    </div>

    <div class="gs">
      <h4 style="color:var(--aud-fg)">â‘¢ ğŸµ CHá»ˆ AUDIO â€” Lá»‡nh yt-dlp</h4>
      <code class="blk"># Chá»‰ Ã¢m thanh MP3:
yt-dlp -x --audio-format mp3 --audio-quality 0 -o "%(title)s.%(ext)s" [URL]

# Ã‚m thanh cháº¥t lÆ°á»£ng cao nháº¥t (khÃ´ng convert):
yt-dlp -x -o "%(title)s.%(ext)s" [URL]</code>
    </div>

    <div class="gs">
      <h4 style="color:var(--warn)">â‘£ Táº¢I HÃ€NG LOáº T</h4>
      <code class="blk"># Táº¡o file links.txt, má»—i dÃ²ng 1 URL, rá»“i cháº¡y:
yt-dlp -f "bestvideo+bestaudio" --merge-output-format mp4 -a links.txt --write-thumbnail -o "%(title)s.%(ext)s"</code>
    </div>

    <div class="gs">
      <h4 style="color:var(--muted)">â‘¤ GHI CHÃš</h4>
      <p>â€¢ Bilibili public: khÃ´ng cáº§n Ä‘Äƒng nháº­p<br>
      â€¢ Douyin: má»™t sá»‘ video cáº§n: <code style="color:var(--accent)">--cookies-from-browser chrome</code><br>
      â€¢ b23.tv lÃ  link rÃºt gá»n Bilibili, yt-dlp tá»± xá»­ lÃ½<br>
      â€¢ Tool nÃ y <strong style="color:var(--vid-fg)">táº¡o lá»‡nh yt-dlp</strong> sáºµn â€” copy dÃ¡n vÃ o terminal lÃ  táº£i Ä‘Æ°á»£c</p>
    </div>
  </div>
</div>

</div><!-- /w -->

<!-- MODAL -->
<div class="mov" id="mov">
  <div class="modal">
    <button class="mc" onclick="closeMod()">âœ•</button>
    <h3 id="mtitle">CHI TIáº¾T</h3>
    <img id="mthumb" src="" alt="" style="display:none" onerror="this.style.display='none'">
    <div class="minfo" id="minfo"></div>
    <div class="macts" id="macts"></div>
  </div>
</div>

<script>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   STATE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const URL_RE=/https?:\/\/(?:(?:www\.)?bilibili\.com\/video\/[A-Za-z0-9_/?=&%#.\-]+|b23\.tv\/[A-Za-z0-9]+|(?:www\.)?douyin\.com\/video\/\d+|v\.douyin\.com\/[A-Za-z0-9]+|vm\.tiktok\.com\/[A-Za-z0-9]+)[^\s\u4e00-\u9fff"'<>]*/g;
let Q=[],SEL=new Set();

function esc(s){return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;')}
function getPlatform(u){return(u.includes('bilibili.com')||u.includes('b23.tv'))?'bilibili':'douyin'}
function getSid(u){const m=u.match(/\/(BV[A-Za-z0-9]+)/)||u.match(/\/video\/(\d+)/);return m?m[1]:u.slice(-10)}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   QUALITY MAP
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const QMAP={
  best:'bestvideo+bestaudio/best',
  '1080':'bestvideo[height<=1080]+bestaudio/best[height<=1080]',
  '720':'bestvideo[height<=720]+bestaudio/best[height<=720]',
  '480':'bestvideo[height<=480]+bestaudio/best[height<=480]',
  '360':'bestvideo[height<=360]+bestaudio/best[height<=360]',
};

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   BUILD COMMANDS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function buildCmd(v, type){
  const q=document.getElementById('qsel').value;
  const vf=document.getElementById('vfmt').value;
  const af=document.getElementById('afmt').value;
  const thumb=document.getElementById('opt-thumb').checked;
  const embed=document.getElementById('opt-embed').checked;
  const fmt=QMAP[q]||'bestvideo+bestaudio/best';
  const out='-o "%(title)s.%(ext)s"';

  if(type==='audio'){
    return `yt-dlp -x --audio-format ${af} --audio-quality 0 ${out} "${v.url}"`;
  } else {
    let cmd=`yt-dlp -f "${fmt}" --merge-output-format ${vf}`;
    if(thumb) cmd+=' --write-thumbnail';
    if(embed)  cmd+=' --embed-thumbnail';
    cmd+=` ${out} "${v.url}"`;
    return cmd;
  }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PARSE LINKS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function parseLinks(){
  const raw=document.getElementById('linkin').value.trim();
  if(!raw){log('w','ChÆ°a nháº­p link');return}
  const urls=(raw.match(URL_RE)||[]).map(u=>u.replace(/[.,!?;ï¼Œã€‚ï¼ï¼Ÿï¼›\])}]+$/,'')).filter((u,i,a)=>a.indexOf(u)===i);
  if(!urls.length){log('e','KhÃ´ng tÃ¬m tháº¥y URL Bilibili/Douyin há»£p lá»‡');return}
  const exist=new Set(Q.map(v=>v.url));
  let added=0;
  const q=document.getElementById('qsel').value;
  urls.forEach(url=>{
    if(exist.has(url)){log('w','ÄÃ£ tá»“n táº¡i: '+url.slice(0,55));return}
    const id='v'+Date.now()+'_'+Math.random().toString(36).slice(2,5);
    const plat=getPlatform(url),sid=getSid(url);
    Q.push({id,url,plat,sid,title:`[${plat.toUpperCase()}] ${sid}`,status:'wait',thumb:null,quality:q,progress:0});
    exist.add(url);added++;
  });
  log('i',`TÃ¬m ${urls.length} link, thÃªm ${added} má»¥c`);
  renderList();sw('queue');
  Q.filter(v=>v.title.startsWith('[')).forEach(v=>fetchMeta(v));
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   META (noembed)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function fetchMeta(item){
  fetch(`https://noembed.com/embed?url=${encodeURIComponent(item.url)}`,{signal:AbortSignal.timeout(8000)})
    .then(r=>r.json()).then(d=>{
      if(d.title&&d.title!='undefined')item.title=d.title;
      if(d.thumbnail_url)item.thumb=d.thumbnail_url;
      refreshItem(item.id);
    }).catch(()=>{});
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   RENDER
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function renderList(){
  const w=document.getElementById('vwrap');
  if(!Q.length){
    w.innerHTML='<div class="empty"><div class="ico">ğŸ“­</div><p>ChÆ°a cÃ³ link nÃ o</p></div>';
    updateStats();return;
  }
  w.innerHTML=`<div class="vlh">
    <span style="width:20px">â˜‘</span>
    <span style="width:70px">THUMB</span>
    <span style="width:72px">Ná»€N Táº¢NG</span>
    <span style="flex:1">TÃŠN VIDEO</span>
    <span style="width:260px;text-align:right">THAO TÃC</span>
  </div><div class="vlist" id="vlist"></div>`;
  Q.forEach(v=>document.getElementById('vlist').appendChild(makeItem(v)));
  updateStats();
}

function makeItem(v){
  const el=document.createElement('div');
  const sc={wait:'',loading:'loading',done:'done',error:'error'}[v.status]||'';
  el.className=`vi ${sc} ${SEL.has(v.id)?'sel':''}`;
  el.id=`vi_${v.id}`;
  const th=v.thumb
    ?`<img src="${esc(v.thumb)}" alt="" onerror="this.parentElement.innerHTML='ğŸ“º'"><div class="pov">â–¶</div>`
    :(v.plat==='bilibili'?'ğŸ“º':'ğŸ“±');
  const st={wait:'<span class="vstat sw">CHá»œTáº¢I</span>',loading:'<span class="vstat sl">â¬‡Táº¢I</span>',done:'<span class="vstat sd">âœ“XONG</span>',error:'<span class="vstat se">âœ—Lá»–I</span>'}[v.status]||'';

  el.innerHTML=`
    <label class="ck" onclick="event.stopPropagation()">
      <input type="checkbox" ${SEL.has(v.id)?'checked':''} onchange="togVI('${v.id}',this.checked)">
      <span class="ck-box">${SEL.has(v.id)?'âœ“':'â˜'}</span>
    </label>
    <div class="vthumb" onclick="showDet('${v.id}')">${th}</div>
    <div style="width:72px;flex-shrink:0"><span class="badge ${v.plat==='bilibili'?'bbili':'bdy'}">${v.plat.toUpperCase()}</span></div>
    <div class="vinfo" onclick="showDet('${v.id}')">
      <div class="vtitle">${esc(v.title)}</div>
      <div class="vurl">${esc(v.url)}</div>
      <div class="vmeta">
        <span class="badge bq">${v.quality==='best'?'BEST':v.quality+'p'}</span>
        ${v.status==='done'?'<span class="badge bok">âœ“XONG</span>':''}
      </div>
      <div class="pw"><div class="pb" id="pb_${v.id}" style="width:${v.progress}%"></div></div>
    </div>
    <div class="vacts">
      <button class="btn btn-vid sm" onclick="event.stopPropagation();doOne('${v.id}','video')" title="Táº£i video cÃ³ Ã¢m thanh">ğŸ“¹ VIDEO+Ã‚M</button>
      <button class="btn btn-aud sm" onclick="event.stopPropagation();doOne('${v.id}','audio')" title="Táº£i chá»‰ Ã¢m thanh">ğŸµ CHá»ˆ AUDIO</button>
      <button class="btn btn-img sm" onclick="event.stopPropagation();dlThumb('${v.id}')" title="Táº£i thumbnail" ${!v.thumb?'disabled':''}>ğŸ–¼</button>
      <button class="btn btn-cmd sm" onclick="event.stopPropagation();showCmd('${v.id}')" title="Xem lá»‡nh yt-dlp">ğŸ“‹</button>
    </div>
    ${st}`;
  return el;
}

function refreshItem(id){
  const v=Q.find(x=>x.id===id);if(!v)return;
  const el=document.getElementById(`vi_${id}`);if(!el)return;
  el.replaceWith(makeItem(v));updateStats();
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SELECT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function togVI(id,c){
  c?SEL.add(id):SEL.delete(id);
  const el=document.getElementById(`vi_${id}`);
  if(el){el.classList.toggle('sel',c);const b=el.querySelector('.ck-box');if(b)b.textContent=c?'âœ“':'â˜'}
  updateStats();updSelBtns();
}
function toggleAll(cb){
  cb.checked?Q.forEach(v=>SEL.add(v.id)):SEL.clear();
  document.getElementById('allbox').textContent=cb.checked?'âœ“':'â˜';
  Q.forEach(v=>{const el=document.getElementById(`vi_${v.id}`);if(el){el.classList.toggle('sel',cb.checked);const b=el.querySelector('.ck-box');if(b)b.textContent=cb.checked?'âœ“':'â˜';const i=el.querySelector('input[type=checkbox]');if(i)i.checked=cb.checked}});
  updateStats();updSelBtns();
}
function updSelBtns(){
  const d=SEL.size===0;
  document.getElementById('btn-sv').disabled=d;
  document.getElementById('btn-sa').disabled=d;
}
function updateStats(){
  document.getElementById('st-t').textContent=Q.length;
  document.getElementById('st-s').textContent=SEL.size;
  document.getElementById('st-d').textContent=Q.filter(v=>v.status==='done').length;
  document.getElementById('st-e').textContent=Q.filter(v=>v.status==='error').length;
  document.getElementById('qc').textContent=Q.length;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SHOW CMD MODAL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function showCmd(id){
  const v=Q.find(x=>x.id===id);if(!v)return;
  const cmdV=buildCmd(v,'video');
  const cmdA=buildCmd(v,'audio');
  document.getElementById('mtitle').textContent='ğŸ“‹ Lá»†NH YT-DLP â€” '+v.title.slice(0,50);
  const th=document.getElementById('mthumb');
  if(v.thumb){th.src=v.thumb;th.style.display='block';}else th.style.display='none';
  document.getElementById('minfo').innerHTML=`
    <strong>URL:</strong> <a href="${esc(v.url)}" target="_blank" style="color:var(--accent);font-size:9px;word-break:break-all">${esc(v.url)}</a><br><br>
    <strong style="color:var(--vid-fg)">ğŸ“¹ VIDEO+Ã‚M:</strong>
    <div class="cmdbox"><textarea readonly onclick="this.select()">${esc(cmdV)}</textarea>
    <button class="btn btn-vid sm" onclick="copyText('${esc(cmdV).replace(/'/g,"\\'")}','video')">ğŸ“‹ Copy</button></div>
    <br><strong style="color:var(--aud-fg)">ğŸµ CHá»ˆ AUDIO:</strong>
    <div class="cmdbox"><textarea readonly onclick="this.select()">${esc(cmdA)}</textarea>
    <button class="btn btn-aud sm" onclick="copyText('${esc(cmdA).replace(/'/g,"\\'")}','audio')">ğŸ“‹ Copy</button></div>
    <br><div style="font-size:9px;color:var(--muted)">
      ğŸ’¡ <strong>Copy lá»‡nh â†’ má»Ÿ Terminal/CMD â†’ dÃ¡n â†’ Enter</strong> Ä‘á»ƒ táº£i vá» mÃ¡y.<br>
      ChÆ°a cÃ³ yt-dlp? Cháº¡y: <code style="color:var(--accent)">pip install yt-dlp</code>
    </div>`;
  document.getElementById('macts').innerHTML=`
    <button class="btn btn-sec sm" onclick="navigator.clipboard?.writeText('${esc(v.url).replace(/'/g,"\\'")}');log('o','ÄÃ£ copy URL!')">ğŸ”— Copy URL</button>
    <button class="btn btn-sec sm" onclick="closeMod()">ÄÃ³ng</button>`;
  document.getElementById('mov').classList.add('open');
}

function copyText(cmd,type){
  const raw=cmd.replace(/&amp;/g,'&').replace(/&lt;/g,'<').replace(/&gt;/g,'>').replace(/&quot;/g,'"');
  navigator.clipboard?.writeText(raw).then(()=>log('o',`ÄÃ£ copy lá»‡nh ${type==='video'?'VIDEO+Ã‚M':'CHá»ˆ AUDIO'}! DÃ¡n vÃ o Terminal Ä‘á»ƒ táº£i.`));
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   DETAIL MODAL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function showDet(id){
  const v=Q.find(x=>x.id===id);if(!v)return;
  const cmdV=buildCmd(v,'video');
  const cmdA=buildCmd(v,'audio');
  document.getElementById('mtitle').textContent='ğŸ“¹ CHI TIáº¾T VIDEO';
  const th=document.getElementById('mthumb');
  if(v.thumb){th.src=v.thumb;th.style.display='block';}else th.style.display='none';
  document.getElementById('minfo').innerHTML=`
    <strong>TÃªn:</strong> ${esc(v.title)}<br>
    <strong>Platform:</strong> ${v.plat.toUpperCase()}<br>
    <strong>ID:</strong> ${v.sid}<br>
    <strong>Cháº¥t lÆ°á»£ng:</strong> ${v.quality==='best'?'Cao nháº¥t':v.quality+'p'}<br>
    <strong>URL:</strong><br>
    <a href="${esc(v.url)}" target="_blank" style="color:var(--accent);font-size:9px;word-break:break-all">${esc(v.url)}</a>`;
  document.getElementById('macts').innerHTML=`
    <button class="btn btn-vid" onclick="copyText('${esc(cmdV).replace(/'/g,"\\'")}','video');doOne('${id}','video');closeMod()">ğŸ“¹ VIDEO+Ã‚M (copy lá»‡nh)</button>
    <button class="btn btn-aud" onclick="copyText('${esc(cmdA).replace(/'/g,"\\'")}','audio');doOne('${id}','audio');closeMod()">ğŸµ CHá»ˆ AUDIO (copy lá»‡nh)</button>
    ${v.thumb?`<button class="btn btn-img" onclick="dlThumb('${id}');closeMod()">ğŸ–¼ Táº¢I áº¢NH</button>`:''}
    <button class="btn btn-sec sm" onclick="closeMod()">ÄÃ³ng</button>`;
  document.getElementById('mov').classList.add('open');
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   DO ONE â€” copy cmd + mark status
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function doOne(id, type){
  const v=Q.find(x=>x.id===id);if(!v)return;
  const cmd=buildCmd(v,type);
  const typeLabel=type==='video'?'VIDEO+Ã‚M':'CHá»ˆ AUDIO';
  // Copy lá»‡nh vÃ o clipboard
  navigator.clipboard?.writeText(cmd).then(()=>{
    log('o',`ÄÃ£ copy lá»‡nh ${typeLabel}! DÃ¡n vÃ o Terminal Ä‘á»ƒ táº£i.`);
  }).catch(()=>{
    log('w','KhÃ´ng copy Ä‘Æ°á»£c tá»± Ä‘á»™ng, hÃ£y nháº¥n ğŸ“‹ Ä‘á»ƒ copy thá»§ cÃ´ng.');
  });
  v.status='done';v.progress=100;
  refreshItem(id);
  log('i',`[${typeLabel}] ${v.title.slice(0,50)}`);
  log('i',`CMD: ${cmd.slice(0,100)}...`);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   BATCH
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function batchDl(type){
  const ids=[...SEL];if(!ids.length)return;
  const cmds=ids.map(id=>{const v=Q.find(x=>x.id===id);return v?buildCmd(v,type):null}).filter(Boolean);
  const allCmd=cmds.join('\n');
  showBatchModal(allCmd, ids.length, type);
  ids.forEach(id=>{const v=Q.find(x=>x.id===id);if(v){v.status='done';refreshItem(id);}});
}

function batchAll(type){
  if(!Q.length)return;
  const cmds=Q.map(v=>buildCmd(v,type));
  const allCmd=cmds.join('\n');
  showBatchModal(allCmd, Q.length, type);
  Q.forEach(v=>{v.status='done';refreshItem(v.id);});
}

function showBatchModal(allCmd, count, type){
  const typeLabel=type==='video'?'VIDEO+Ã‚M':'CHá»ˆ AUDIO';
  document.getElementById('mtitle').textContent=`ğŸ“¦ BATCH Lá»†NH ${typeLabel} (${count} video)`;
  document.getElementById('mthumb').style.display='none';
  document.getElementById('minfo').innerHTML=`
    <strong>${count} lá»‡nh yt-dlp (${typeLabel}):</strong>
    <div class="cmdbox" style="margin-top:8px">
      <textarea readonly style="height:160px" onclick="this.select()">${esc(allCmd)}</textarea>
    </div>
    <br><div style="font-size:9px;color:var(--muted)">
      Hoáº·c táº¡o <code style="color:var(--accent)">links.txt</code> rá»“i cháº¡y:<br>
      <code style="color:var(--green)">yt-dlp ${type==='audio'?'-x --audio-format mp3':'-f "bestvideo+bestaudio" --merge-output-format mp4'} --write-thumbnail -a links.txt -o "%(title)s.%(ext)s"</code>
    </div>`;
  document.getElementById('macts').innerHTML=`
    <button class="btn ${type==='video'?'btn-vid':'btn-aud'}" onclick="navigator.clipboard?.writeText(${JSON.stringify(allCmd)});log('o','ÄÃ£ copy táº¥t cáº£ ${count} lá»‡nh!')">ğŸ“‹ Copy táº¥t cáº£ lá»‡nh</button>
    <button class="btn btn-sec sm" onclick="closeMod()">ÄÃ³ng</button>`;
  document.getElementById('mov').classList.add('open');
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   THUMBNAIL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function dlThumb(id){
  const v=Q.find(x=>x.id===id);if(!v||!v.thumb){log('w','ChÆ°a cÃ³ thumbnail');return}
  const fname=`${v.sid}_thumb.jpg`;
  fetch(v.thumb,{signal:AbortSignal.timeout(15000)})
    .then(r=>r.blob()).then(blob=>{
      const a=document.createElement('a');a.href=URL.createObjectURL(blob);a.download=fname;
      document.body.appendChild(a);a.click();document.body.removeChild(a);
      setTimeout(()=>URL.revokeObjectURL(a.href),5000);
      log('o',`âœ“ ÄÃ£ táº£i áº£nh: ${fname}`);
    }).catch(()=>{
      const a=document.createElement('a');a.href=v.thumb;a.target='_blank';a.click();
      log('o','Má»Ÿ áº£nh trong tab má»›i');
    });
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   MISC
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function clearQ(){if(!Q.length)return;Q=[];SEL.clear();renderList();log('w','ÄÃ£ xÃ³a hÃ ng Ä‘á»£i')}
function closeMod(){document.getElementById('mov').classList.remove('open')}
document.getElementById('mov').addEventListener('click',e=>{if(e.target===document.getElementById('mov'))closeMod()});

function log(type,msg){
  const b=document.getElementById('logbox');if(!b)return;
  const d=document.createElement('div');d.className='ll l'+type;
  d.textContent=`[${new Date().toLocaleTimeString('vi-VN')}] ${msg}`;
  b.appendChild(d);b.scrollTop=b.scrollHeight;
}

function sw(name){
  document.querySelectorAll('.tab-pane').forEach(p=>p.classList.remove('active'));
  document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
  document.getElementById('tab-'+name).classList.add('active');
  const m={input:0,queue:1,guide:2};
  document.querySelectorAll('.tab')[m[name]].classList.add('active');
}

window.addEventListener('load',()=>{
  log('i','BiliDown sáºµn sÃ ng âš™ yt-dlp Engine â€” Nháº­p link vÃ  nháº¥n PhÃ¢n TÃ­ch Link');
});
</script>
</body>
</html>